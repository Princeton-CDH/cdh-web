{% extends 'base.html' %}
{% load mezzanine_tags %}

{% block page-subtitle %}{{ profile.title }} | People | {% endblock %}

{% block extra-head %}
    <meta name="profile.first_name" content="{{ profile.user.first_name }}"/>
    <meta name="profile.last_name" content="{{ profile.user.last_name }}"/>
{% endblock %}


{% block main %}
<div class="profile">
<header>
    <h1>{{ profile.title }}</h1>
    {# display all positions, current first; dates for non-current #}
    {% for position in profile.user.positions.all %}
        <p class="title">{% if not position.is_current %}
            {{ position.start_date.year }}{% if position.end_date.year != position.start_date.year%}-{{ position.end_date.year }}{% endif %}
            {% endif %}
        {{ position.title }}
        </p>
    {% endfor %}
</header>

<div class="links">
    {# NOTE equiv to contributors in project #}
    <ul>
    {% for resource in profile.user.userresource_set.all %}
        <li><a href="{{ resource.url }}">{{ resource.resource_type.name }}</a></li>
    {% endfor %}
    </ul>
</div>

{% if profile.image %}
<img src="{{ MEDIA_URL }}{{ profile.image }}" alt="photo of {{ profile.title }}"/>
{% endif %}

<div class="education">
{{ profile.education|safe }}
<a href="mailto:{{ profile.user.email }}">{{ profile.user.email }}</a>
</div>

<div class="bio">
{{ profile.bio|safe }}
</div>

{% if recent_posts %}
<div class="recent-posts">
    <h2>Recent Posts</h2>
    {% for post in recent_posts %}
    <div class="blogpost">
        <header>
            <a href="{{ post.get_absolute_url }}"><span class="title">{{ post.title }}</span></a>
            <div class="byline">
                {# show other authors if the user isn't the only author #}
                {% if post.users.count > 1 %}
                <div class="authors">
                    <span>with </span>
                    {% for author in post.users.all %}
                        {% if author.id is not profile.user.id %}
                        <span property="schema:author" typeof="schema:Person">
                            <a {% if author.profile %}property="schema:url" href="{{ author.profile.get_absolute_url }}"{% endif %}>
                            <span property="schema:name">{{ author }}</span></a>{% if not forloop.last %}, {% endif %}
                        </span>
                        {% endif %}
                    {% endfor %}
                </div>
                {% endif %}
                <span class="date-published">{{ post.publish_date|date:"F j, Y" }}</span>
            </div>
        </header>
    </div>
    {% endfor %}
</div>
{% endif %}

</div>
{% endblock %}
