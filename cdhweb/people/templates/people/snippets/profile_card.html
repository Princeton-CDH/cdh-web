{# display person profile card; expects profile object as profile #}
<div class="card profile"
    {% if profile.thumb %}style="background-image:url('{{ MEDIA_URL }}{{ profile.thumb }}')"{% endif %}>
    {% with profile.user.profile_url as profile_url %} {# local or external profile, if available #}
      {% with profile_url|yesno:"a,div" as tag %} {# link if we have a url, otherwise div #}
      <{{ tag }} {% if profile_url %}href="{{ profile_url }}"{% endif %} title="{{ profile.title }}">
        <div class="content">
        {% with position=profile.user.positions.first %}
        <p class="title">
            {% if position %}
                {% if not position.is_current %}{{ position.years }}<br/>{% endif %} {# cdh position #}
                {{ profile.user.positions.first.title|default:'' }}
            {% elif profile.user.membership_set and profile.user.latest_grant %} {# if no CDH position: display grant role #}
                {% with grant=profile.user.latest_grant %}
                    {% if not grant.is_current %}{{ grant.years }}<br/>{% endif %}
                    {{ grant.grant_type }} Grant Recipient
                {% endwith %}
            {% endif %}
            {% if profile.user.event_set.upcoming %}
                {{ profile.user.event_set.first.start_time|date:"N d, P" }}
            {% else %}
                {{ profile.user.event_set.first.start_time|date:"Y" }}
            {% endif %}
        </p>
        {% endwith %}
        <p class="name">{{ profile.title }}</p>
        </div>
      </{{ tag }}>
      {% endwith %}
    {% endwith %}
</div>