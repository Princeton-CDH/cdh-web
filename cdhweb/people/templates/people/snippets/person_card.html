{% load wagtailcore_tags wagtailimages_tags %}

{# default card display for a person #}
<div class="card profile">
    {# link if we have a profile or website URL, otherwise div #}
    {% with person.profile_url|yesno:"a,div" as tag %}
    <{{ tag }} {% if person.profile_url %}href="{{ person.profile_url }}"{% endif %} aria-label="{% firstof profile.title person %}">
        {% if person.card_image %}
            {% image person.card_image fill-310x240 as profile_img %}
            <div class="image" style="background-image:url('{{ profile_img.url }}')"></div>
        {% else %}
            <div class="image"></div>
        {% endif %}
        <div class="content">
            <p class="name">{% if profile %}{{ profile.title }}{% else %}{{ person }}{% endif %}</p>
            {# use in order of availability: cdh position, project role, event speaker + institution, job title + institution #}
            <div class="title">
            {% with position=person.positions.first membership=person.membership_set.first event=person.user.event_set.first %}
                {% if position %}
                    <p>{% if not position.is_current %}{{ position.years }} {% endif %}{{ position.title }}</p>
                {% elif membership %}
                    <p>{% if not membership.is_current %}{{ membership.years }} {% endif %}{{ membership.role }}</p>
                {% elif event %}
                    <p>{{ event.start_time.year }} Speaker{% if person.institution %}<br/>{{ person.institution }}{% endif %}</p>
                {% elif person.job_title %}
                    <p>{{ person.job_title }}{% if person.institution %}<br/>{{ person.institution }}{% endif %}</p>
                {% endif %}
            {% endwith %}
            </div>
        </div>
    </{{ tag }}>
    {% endwith %}
</div>
